{
  "$schema": "./schema.json",
  "id": "F003",
  "name": "Multi-Agent AI Chat",
  "description": "Collaborative chat environment where multiple AI agents and human team members can participate in strategic discussions, with each AI agent having specialized expertise, configurable personality traits, and access to organizational context",
  "status": "implemented",
  "priority": "should-have",
  "created_at": "2026-01-17",
  "updated_at": "2026-01-22",
  "owner": "ai-team",

  "implementation_status": {
    "summary": "Fully implemented. Phase 1 (Agent Management) and Phase 2 (Group Chat) complete.",
    "phases": [
      {
        "id": "phase-1",
        "name": "AI Agent Management",
        "status": "complete",
        "components": [
          { "name": "AiAgent entity", "status": "complete", "file": "orbitos-api/src/OrbitOS.Domain/Entities/AiAgent.cs" },
          { "name": "AiAgents API controller", "status": "complete", "file": "orbitos-api/src/OrbitOS.Api/Controllers/AiAgentsController.cs" },
          { "name": "Multi-provider AI service", "status": "complete", "file": "orbitos-api/src/OrbitOS.Api/Services/MultiProviderAiService.cs" },
          { "name": "Database migration", "status": "complete", "file": "orbitos-api/src/OrbitOS.Infrastructure/Migrations/20260117104120_AddAiAgentsEntity" },
          { "name": "AI Agents page (frontend)", "status": "complete", "file": "orbitos-web/app/pages/app/ai-agents/index.vue" },
          { "name": "useAiAgents composable", "status": "complete", "file": "orbitos-web/app/composables/useAiAgents.ts" },
          { "name": "Sidebar navigation link", "status": "complete", "file": "orbitos-web/app/layouts/app.vue" },
          { "name": "E2E tests", "status": "complete", "file": "orbitos-web/tests/e2e/ai-agents.spec.ts" }
        ]
      },
      {
        "id": "phase-2",
        "name": "Group Chat Interface",
        "status": "complete",
        "components": [
          { "name": "Conversation entity", "status": "complete", "file": "orbitos-api/src/OrbitOS.Domain/Entities/Conversation.cs" },
          { "name": "Message entity", "status": "complete", "file": "orbitos-api/src/OrbitOS.Domain/Entities/Message.cs" },
          { "name": "ConversationParticipant entity", "status": "complete", "file": "orbitos-api/src/OrbitOS.Domain/Entities/ConversationParticipant.cs" },
          { "name": "Conversations API controller", "status": "complete", "file": "orbitos-api/src/OrbitOS.Api/Controllers/ConversationsController.cs" },
          { "name": "Database migration", "status": "complete", "file": "orbitos-api/src/OrbitOS.Infrastructure/Migrations/20260117112205_AddConversationEntities" },
          { "name": "Chat page UI", "status": "complete", "file": "orbitos-web/app/pages/app/ai-agents/conversations/[id].vue" },
          { "name": "useConversations composable", "status": "complete", "file": "orbitos-web/app/composables/useConversations.ts" },
          { "name": "Message composer with @mentions", "status": "complete" },
          { "name": "Context panel (referenced items)", "status": "complete" },
          { "name": "Session stats panel", "status": "complete" },
          { "name": "Conversation mode selector", "status": "complete" },
          { "name": "E2E tests", "status": "complete", "file": "orbitos-web/tests/e2e/conversations.spec.ts" }
        ]
      }
    ]
  },

  "capabilities": [
    {
      "id": "F003-C01",
      "description": "As a user, I want to create a new conversation with selected AI agents and team members so that we can collaborate on strategic discussions",
      "priority": "must-have",
      "status": "complete",
      "acceptance_criteria": [
        "Given I am on the AI Agents page, when I click 'New' conversation, then I can select participants",
        "Given I select AI agents and team members, when I create the conversation, then all participants are added",
        "Given a conversation is created, when it loads, then I see the participant list and chat interface"
      ]
    },
    {
      "id": "F003-C02",
      "description": "As a user, I want to @mention specific AI agents in my message so that they respond to my query",
      "priority": "must-have",
      "status": "complete",
      "acceptance_criteria": [
        "Given I type '@' in the message input, when I continue typing, then I see autocomplete for available agents",
        "Given I @mention an AI agent, when I send the message, then that specific agent responds",
        "Given I @mention multiple agents, when I send the message, then each mentioned agent responds in order"
      ]
    },
    {
      "id": "F003-C03",
      "description": "As a user, I want to configure the conversation mode so that I can control how AI agents interact",
      "priority": "must-have",
      "status": "complete",
      "acceptance_criteria": [
        "Given I am in a conversation, when I click the mode selector, then I see On-Demand, Moderated, Round-Robin, and Free options",
        "Given I select 'On-Demand' mode, when I send a message without @mention, then no AI responds automatically",
        "Given I select 'Moderated' mode, when an AI wants to respond, then it waits for moderator approval",
        "Given I select 'Round-Robin' mode, when I send a message, then each AI responds in turn",
        "Given I select 'Free' mode, when I send a message, then all relevant AIs may respond"
      ]
    },
    {
      "id": "F003-C04",
      "description": "As a user, I want to see which organizational data the AI agents have access to so that I understand the context they're using",
      "priority": "must-have",
      "status": "complete",
      "acceptance_criteria": [
        "Given I am in a conversation, when I view the context panel, then I see 'Full Context Access' section",
        "Given the context panel shows Canvases, when I click on it, then I see which canvases are accessible",
        "Given an AI references data, when it responds, then it shows 'Sources' with the data origins"
      ]
    },
    {
      "id": "F003-C05",
      "description": "As a user, I want to see session statistics so that I can monitor token usage and costs",
      "priority": "should-have",
      "status": "complete",
      "acceptance_criteria": [
        "Given I am in a conversation, when I view the stats panel, then I see message count, AI responses, total tokens, cost, and duration",
        "Given tokens are being consumed, when an AI responds, then the token count updates in real-time",
        "Given there is a token limit, when usage approaches the limit, then I see a warning indicator"
      ]
    },
    {
      "id": "F003-C06",
      "description": "As an admin, I want to configure AI agents with different models, specializations, and personality traits so that they provide domain-specific expertise with appropriate behavior",
      "priority": "must-have",
      "status": "complete",
      "acceptance_criteria": [
        "Given I am an admin, when I access agent settings, then I can create a new AI agent",
        "Given I create an AI agent, when I configure it, then I can set name, model (Claude Opus/Sonnet/Haiku), role title, system prompt, and capabilities",
        "Given I configure capabilities, when I select tools, then the agent can only use those specific tools",
        "Given I configure a system prompt, when I use a template, then the prompt is pre-populated with CFO/Operations/Strategy/HR personality",
        "Given I configure generation parameters, when I set temperature and max tokens, then the agent uses those settings"
      ]
    },
    {
      "id": "F003-C07",
      "description": "As a user, I want AI agents to render rich responses with charts and metrics so that data is visually clear",
      "priority": "should-have",
      "status": "partial",
      "acceptance_criteria": [
        "Given an AI analyzes metrics, when it responds, then it can include formatted metric cards",
        "Given an AI references multiple sources, when it responds, then sources are listed at the bottom",
        "Given an AI provides insights, when it responds, then key insights are highlighted"
      ]
    },
    {
      "id": "F003-C08",
      "description": "As a user, I want quick actions (Ask all AIs, Summarize, Export chat, Pause all AIs) so that I can efficiently manage the conversation",
      "priority": "should-have",
      "status": "complete",
      "acceptance_criteria": [
        "Given I click 'Ask all AIs', when the action executes, then all active AI agents respond to the last message",
        "Given I click 'Summarize', when the action executes, then an AI generates a summary of the conversation",
        "Given I click 'Export chat', when the action executes, then I can download the conversation as PDF/Markdown",
        "Given I click 'Pause all AIs', when the action executes, then AI agents stop responding until resumed"
      ]
    },
    {
      "id": "F003-C09",
      "description": "As a user, I want to see which team members are online so that I know who is available for collaboration",
      "priority": "could-have",
      "status": "pending",
      "acceptance_criteria": [
        "Given I am in the AI Agents view, when I look at Team Members, then I see online status indicators",
        "Given a team member comes online, when their status changes, then the indicator updates in real-time",
        "Given I hover over a team member, when viewing their status, then I see their role"
      ]
    },
    {
      "id": "F003-C10",
      "description": "As a user, I want to pause and resume the conversation so that I can control when AI agents are active",
      "priority": "must-have",
      "status": "complete",
      "acceptance_criteria": [
        "Given a conversation is active, when I click 'Pause', then AI agents stop responding",
        "Given a conversation is paused, when I click 'Resume', then AI agents can respond again",
        "Given a conversation is paused, when I send a message, then it's queued until resumed"
      ]
    },
    {
      "id": "F003-C11",
      "description": "As a user, I want to see items referenced in the chat so that I can quickly access related resources",
      "priority": "should-have",
      "status": "complete",
      "acceptance_criteria": [
        "Given an AI references a Canvas, when the message is displayed, then the canvas appears in 'Referenced in Chat' panel",
        "Given items are referenced, when I click on a reference, then it opens that resource",
        "Given multiple items are referenced, when viewing the panel, then they are sorted by recency"
      ]
    }
  ],

  "entities": [
    "ENT017",
    "ENT018",
    "ENT019",
    "ENT020"
  ],

  "agent_configuration": {
    "description": "Comprehensive AI agent configuration system enabling domain-specific expertise through model selection, system prompts, personality traits, and generation parameters",
    "identity_configuration": {
      "name": "Display name shown in conversations (e.g., 'CFO-AI', 'Ops-AI')",
      "role_title": "Role description shown under name (e.g., 'Chief Financial Officer')",
      "avatar_color": "8 color options for visual distinction in conversations",
      "description": "Brief description of agent's expertise for other users"
    },
    "model_selection": {
      "available_models": [
        {
          "id": "claude-opus-4-20250514",
          "name": "Claude Opus 4",
          "provider": "anthropic",
          "description": "Most capable model. Best for complex analysis, nuanced reasoning, and high-stakes decisions.",
          "context_window": 200000,
          "cost_tier": "high",
          "use_cases": ["Strategic planning", "Complex financial analysis", "Risk assessment", "Executive advisory"]
        },
        {
          "id": "claude-sonnet-4-20250514",
          "name": "Claude Sonnet 4",
          "provider": "anthropic",
          "description": "Balanced model. Great for most business tasks - analysis, recommendations, and general advisory.",
          "context_window": 200000,
          "cost_tier": "medium",
          "use_cases": ["Daily advisory", "Document analysis", "Process recommendations", "General questions"]
        },
        {
          "id": "claude-3-5-haiku-20241022",
          "name": "Claude 3.5 Haiku",
          "provider": "anthropic",
          "description": "Fastest and most affordable. Ideal for quick responses, simple tasks, and high-volume interactions.",
          "context_window": 200000,
          "cost_tier": "low",
          "use_cases": ["Quick questions", "Simple lookups", "Data extraction", "Routine tasks"]
        }
      ],
      "future_providers": ["OpenAI (GPT-4)", "Google (Gemini)"]
    },
    "generation_parameters": {
      "temperature": {
        "description": "Controls response creativity and variability",
        "range": "0.0 - 2.0",
        "default": 0.7,
        "guidelines": {
          "low": "0.1-0.3: Consistent, factual, conservative responses. Best for financial analysis, compliance, factual queries.",
          "medium": "0.4-0.7: Balanced creativity. Best for general advisory, recommendations, problem-solving.",
          "high": "0.8-1.0: Creative, varied, exploratory responses. Best for brainstorming, ideation, creative solutions."
        }
      },
      "max_tokens": {
        "description": "Maximum response length",
        "default": 4096,
        "guidelines": "1024 tokens ≈ 750 words. Set based on expected response complexity."
      }
    },
    "system_prompts": {
      "description": "The system prompt defines the agent's identity, expertise, and behavioral patterns. Templates are provided but fully customizable.",
      "templates": [
        {
          "id": "cfo",
          "name": "CFO / Finance",
          "traits": ["Financial analysis focus", "Risk-aware", "ROI-driven", "Budget-conscious"],
          "example_prompt": "You are a seasoned CFO with 20+ years of experience in financial strategy and risk management. You analyze every decision through the lens of financial impact, ROI, and risk exposure. You ask clarifying questions about budget constraints and always consider the financial implications of recommendations."
        },
        {
          "id": "operations",
          "name": "Operations Manager",
          "traits": ["Process-oriented", "Efficiency-focused", "Practical", "Detail-oriented"],
          "example_prompt": "You are an Operations expert who thinks in terms of processes, workflows, and efficiency. You identify bottlenecks, suggest process improvements, and always consider implementation feasibility. You ask about resource constraints and timelines."
        },
        {
          "id": "strategy",
          "name": "Strategy Consultant",
          "traits": ["Big-picture thinking", "Competitive analysis", "Long-term focus", "Framework-driven"],
          "example_prompt": "You are a Strategy consultant who thinks about competitive positioning, market dynamics, and long-term vision. You use frameworks like Porter's Five Forces, SWOT, and Blue Ocean Strategy. You challenge assumptions and look for strategic opportunities."
        },
        {
          "id": "hr",
          "name": "HR Director",
          "traits": ["People-focused", "Culture-aware", "Compliance-minded", "Empathetic"],
          "example_prompt": "You are an HR Business Partner who considers the human element in every decision. You think about team capacity, skills gaps, culture fit, and employee wellbeing. You flag potential compliance issues and consider change management implications."
        }
      ],
      "personality_traits": {
        "description": "Configurable personality dimensions that affect how agents communicate and interact",
        "traits": [
          {
            "name": "Assertiveness",
            "description": "How strongly the agent advocates for its viewpoint",
            "levels": [
              { "level": 1, "name": "Deferential", "description": "Suggests gently, easily persuaded, focuses on supporting others' ideas" },
              { "level": 2, "name": "Balanced", "description": "States opinions clearly, open to debate, considers alternatives" },
              { "level": 3, "name": "Assertive", "description": "Strongly advocates, pushes back on disagreements, confident in recommendations" }
            ]
          },
          {
            "name": "Communication Style",
            "description": "How the agent structures and delivers responses",
            "levels": [
              { "level": 1, "name": "Concise", "description": "Brief, bullet-point focused, gets to the point quickly" },
              { "level": 2, "name": "Balanced", "description": "Mix of detail and brevity, adapts to question complexity" },
              { "level": 3, "name": "Comprehensive", "description": "Detailed explanations, thorough analysis, extensive context" }
            ]
          },
          {
            "name": "Risk Tolerance",
            "description": "How the agent approaches uncertainty and risk",
            "levels": [
              { "level": 1, "name": "Conservative", "description": "Emphasizes caution, highlights risks, recommends proven approaches" },
              { "level": 2, "name": "Moderate", "description": "Balanced risk assessment, weighs pros and cons fairly" },
              { "level": 3, "name": "Aggressive", "description": "Focuses on opportunities, comfortable with uncertainty, action-oriented" }
            ]
          },
          {
            "name": "Collaboration Style",
            "description": "How the agent interacts with other agents in multi-agent conversations",
            "levels": [
              { "level": 1, "name": "Supportive", "description": "Builds on others' ideas, validates contributions, seeks consensus" },
              { "level": 2, "name": "Independent", "description": "Offers distinct perspective, contributes unique insights" },
              { "level": 3, "name": "Challenging", "description": "Plays devil's advocate, questions assumptions, surfaces blind spots" }
            ]
          }
        ]
      }
    }
  },

  "conversation_modes": {
    "description": "Different modes control how AI agents participate in conversations",
    "modes": [
      {
        "id": "on-demand",
        "name": "On-Demand",
        "description": "AI agents only respond when explicitly mentioned with @AgentName. Gives full control over when each agent participates.",
        "best_for": "Targeted questions, controlled discussions, specific expertise needed",
        "example": "You: '@CFO what are the financial implications of this expansion?' → Only CFO responds"
      },
      {
        "id": "round-robin",
        "name": "Round-Robin",
        "description": "After each user message, agents take turns responding in a set order. Each agent gets a chance to contribute.",
        "best_for": "Comprehensive analysis, ensuring all perspectives are heard, structured discussions",
        "example": "You: 'Should we enter this market?' → CFO responds, then Operations, then Strategy, then HR"
      },
      {
        "id": "moderated",
        "name": "Moderated",
        "description": "Agents draft responses, but they're held for your approval before being added to the conversation. You can edit, approve, or reject.",
        "best_for": "High-stakes discussions, quality control, sensitive topics",
        "example": "Agents draft responses → You review each → Approve/Edit/Reject → Approved messages appear"
      },
      {
        "id": "free",
        "name": "Free (Caution)",
        "description": "Agents can respond to each other and engage in natural back-and-forth discussion. Most dynamic but least controlled. Can lead to high token usage.",
        "best_for": "Brainstorming, creative problem-solving, exploring ideas",
        "example": "CFO raises concern → Operations responds → Strategy adds perspective → Natural conversation emerges"
      }
    ]
  },

  "data_access": {
    "description": "AI agents have read access to organizational data to provide context-aware responses",
    "read_access": {
      "description": "Automatic read access to organization data injected into context",
      "items": [
        "Organization profile and settings",
        "Business Model Canvas (all 9 blocks)",
        "Organizational chart and reporting relationships",
        "Roles, functions, and assignments",
        "People and resource allocation",
        "Processes and activities",
        "Partners, channels, and value propositions"
      ]
    },
    "proposed_actions": {
      "description": "Agents can propose changes that require human approval via pending actions workflow",
      "items": [
        "Create new entities (roles, processes, etc.)",
        "Update existing records",
        "Assign people to roles",
        "Modify process activities",
        "Update canvas block content"
      ]
    },
    "never_allowed": {
      "description": "Actions that are never permitted for AI agents",
      "items": [
        "Direct database modifications without approval",
        "Access to other organizations' data",
        "Deletion of critical data",
        "Changes without audit trail"
      ]
    }
  },

  "api_endpoints": [
    {
      "method": "GET",
      "path": "/api/organizations/{orgId}/ai-agents",
      "description": "List all AI agents configured for the organization",
      "response": "AiAgentDto[]",
      "status": "implemented"
    },
    {
      "method": "POST",
      "path": "/api/organizations/{orgId}/ai-agents",
      "description": "Create a new AI agent",
      "request_body": "CreateAiAgentRequest",
      "response": "AiAgentDto",
      "status": "implemented"
    },
    {
      "method": "GET",
      "path": "/api/organizations/{orgId}/ai-agents/{agentId}",
      "description": "Get a specific AI agent",
      "response": "AiAgentDto",
      "status": "implemented"
    },
    {
      "method": "PUT",
      "path": "/api/organizations/{orgId}/ai-agents/{agentId}",
      "description": "Update an AI agent configuration",
      "request_body": "UpdateAiAgentRequest",
      "response": "AiAgentDto",
      "status": "implemented"
    },
    {
      "method": "DELETE",
      "path": "/api/organizations/{orgId}/ai-agents/{agentId}",
      "description": "Delete an AI agent (soft delete)",
      "response": "204 No Content",
      "status": "implemented"
    },
    {
      "method": "GET",
      "path": "/api/organizations/{orgId}/ai-agents/available-models",
      "description": "Get list of available AI models",
      "response": "AvailableModelDto[]",
      "status": "implemented"
    },
    {
      "method": "GET",
      "path": "/api/organizations/{orgId}/conversations",
      "description": "List all conversations for the user",
      "response": "ConversationSummaryDto[]",
      "status": "implemented"
    },
    {
      "method": "POST",
      "path": "/api/organizations/{orgId}/conversations",
      "description": "Create a new conversation",
      "request_body": "CreateConversationRequest",
      "response": "ConversationDto",
      "status": "implemented"
    },
    {
      "method": "GET",
      "path": "/api/organizations/{orgId}/conversations/{conversationId}",
      "description": "Get conversation details with messages",
      "response": "ConversationDto",
      "status": "implemented"
    },
    {
      "method": "DELETE",
      "path": "/api/organizations/{orgId}/conversations/{conversationId}",
      "description": "Delete a conversation (soft delete)",
      "response": "204 No Content",
      "status": "implemented"
    },
    {
      "method": "POST",
      "path": "/api/organizations/{orgId}/conversations/{conversationId}/messages",
      "description": "Send a message to the conversation",
      "request_body": "SendMessageRequest",
      "response": "MessageDto",
      "status": "implemented"
    },
    {
      "method": "GET",
      "path": "/api/organizations/{orgId}/conversations/{conversationId}/messages",
      "description": "Get paginated messages for a conversation",
      "query_params": ["cursor", "limit"],
      "response": "PaginatedResponse<MessageDto>",
      "status": "implemented"
    },
    {
      "method": "POST",
      "path": "/api/organizations/{orgId}/conversations/{conversationId}/invoke",
      "description": "Invoke AI agent(s) to respond",
      "request_body": "InvokeAgentRequest",
      "response": "MessageDto[]",
      "status": "implemented"
    },
    {
      "method": "PUT",
      "path": "/api/organizations/{orgId}/conversations/{conversationId}/settings",
      "description": "Update conversation settings (mode, participants)",
      "request_body": "UpdateConversationSettingsRequest",
      "response": "ConversationDto",
      "status": "implemented"
    },
    {
      "method": "POST",
      "path": "/api/organizations/{orgId}/conversations/{conversationId}/pause",
      "description": "Pause AI responses in the conversation",
      "response": "ConversationDto",
      "status": "implemented"
    },
    {
      "method": "POST",
      "path": "/api/organizations/{orgId}/conversations/{conversationId}/resume",
      "description": "Resume AI responses in the conversation",
      "response": "ConversationDto",
      "status": "implemented"
    },
    {
      "method": "POST",
      "path": "/api/organizations/{orgId}/conversations/{conversationId}/summarize",
      "description": "Generate a summary of the conversation",
      "response": "SummaryDto",
      "status": "implemented"
    },
    {
      "method": "GET",
      "path": "/api/organizations/{orgId}/conversations/{conversationId}/export",
      "description": "Export conversation as PDF or Markdown",
      "query_params": ["format"],
      "response": "FileStreamResult",
      "status": "partial"
    }
  ],

  "ui_screens": [
    {
      "id": "SCR010",
      "name": "AI Agents Management",
      "description": "Page for creating, viewing, editing, and deleting AI agents",
      "path": "/app/ai-agents",
      "file": "orbitos-web/app/pages/app/ai-agents/index.vue",
      "status": "implemented",
      "ui_elements": [
        {
          "id": "SCR010-EL01",
          "name": "Page Header",
          "type": "section",
          "elements": [
            { "id": "heading", "type": "heading", "text": "AI Agents" },
            { "id": "subheading", "type": "text", "text": "Configure AI agents with different models and specializations." },
            { "id": "add-btn", "type": "button", "text": "Add Agent", "action": "opens create dialog" }
          ]
        },
        {
          "id": "SCR010-EL02",
          "name": "Stats Cards",
          "type": "section",
          "elements": [
            { "id": "total-agents", "type": "stat-card", "label": "Total Agents" },
            { "id": "active-agents", "type": "stat-card", "label": "Active" },
            { "id": "anthropic-count", "type": "stat-card", "label": "Anthropic" },
            { "id": "other-count", "type": "stat-card", "label": "OpenAI / Google" }
          ]
        },
        {
          "id": "SCR010-EL03",
          "name": "Empty State",
          "type": "conditional",
          "condition": "agents.length === 0",
          "elements": [
            { "id": "icon", "type": "icon", "name": "computer" },
            { "id": "title", "type": "heading", "text": "No AI Agents Yet" },
            { "id": "description", "type": "text" },
            { "id": "cta-btn", "type": "button", "text": "Create your first agent" }
          ]
        },
        {
          "id": "SCR010-EL04",
          "name": "Agents Grid",
          "type": "grid",
          "elements": [
            {
              "id": "agent-card",
              "type": "card",
              "repeats": "for each agent",
              "elements": [
                { "id": "avatar", "type": "avatar", "shows": "first letter of name, colored background" },
                { "id": "name", "type": "text", "field": "agent.name" },
                { "id": "inactive-badge", "type": "badge", "condition": "!agent.isActive", "text": "Inactive" },
                { "id": "role-title", "type": "text", "field": "agent.roleTitle" },
                { "id": "model-badge", "type": "badge", "field": "agent.modelDisplayName", "color": "provider-based" },
                { "id": "max-tokens", "type": "text", "format": "{maxTokensPerResponse} max tokens" },
                { "id": "prompt-preview", "type": "text", "field": "agent.systemPrompt", "truncated": true },
                { "id": "toggle-btn", "type": "button", "text": "Disable/Enable", "action": "toggleAgentActive" },
                { "id": "edit-btn", "type": "button", "text": "Edit", "action": "opens edit dialog" },
                { "id": "delete-btn", "type": "button", "text": "Delete", "action": "deleteAgent with confirm" }
              ]
            }
          ]
        },
        {
          "id": "SCR010-EL05",
          "name": "Create Agent Dialog",
          "type": "dialog",
          "trigger": "Add Agent button",
          "elements": [
            { "id": "title", "type": "heading", "text": "Create AI Agent" },
            { "id": "description", "type": "text", "text": "Configure a new AI agent with a specific model and role." },
            { "id": "name-input", "type": "text-input", "label": "Agent Name *", "placeholder": "e.g., CFO-AI" },
            { "id": "role-input", "type": "text-input", "label": "Role Title *", "placeholder": "e.g., Chief Financial Officer" },
            { "id": "model-select", "type": "select", "label": "AI Model *", "options": "available models grouped by provider" },
            { "id": "template-select", "type": "select", "label": "System Prompt Template", "options": ["Custom", "CFO / Finance", "Operations Manager", "Strategy Consultant", "HR Director"] },
            { "id": "prompt-textarea", "type": "textarea", "label": "System Prompt *", "rows": 6 },
            { "id": "max-tokens-input", "type": "number-input", "label": "Max Tokens", "default": 4096 },
            { "id": "temperature-input", "type": "number-input", "label": "Temperature (0-2)", "default": 0.7, "step": 0.1 },
            { "id": "color-picker", "type": "color-picker", "label": "Avatar Color", "colors": 8 },
            { "id": "cancel-btn", "type": "button", "text": "Cancel", "action": "closes dialog" },
            { "id": "create-btn", "type": "button", "text": "Create Agent", "action": "createAgent", "disabled-when": "form invalid" }
          ]
        },
        {
          "id": "SCR010-EL06",
          "name": "Edit Agent Dialog",
          "type": "dialog",
          "trigger": "Edit button on agent card",
          "elements": [
            { "id": "title", "type": "heading", "text": "Edit AI Agent" },
            { "id": "description", "type": "text", "text": "Update agent configuration." },
            { "id": "name-input", "type": "text-input", "label": "Agent Name *", "value": "agent.name" },
            { "id": "role-input", "type": "text-input", "label": "Role Title *", "value": "agent.roleTitle" },
            { "id": "model-select", "type": "select", "label": "AI Model *", "value": "agent.modelId" },
            { "id": "prompt-textarea", "type": "textarea", "label": "System Prompt *", "value": "agent.systemPrompt" },
            { "id": "max-tokens-input", "type": "number-input", "label": "Max Tokens", "value": "agent.maxTokensPerResponse" },
            { "id": "temperature-input", "type": "number-input", "label": "Temperature (0-2)", "value": "agent.temperature" },
            { "id": "color-picker", "type": "color-picker", "label": "Avatar Color", "value": "agent.avatarColor" },
            { "id": "active-checkbox", "type": "checkbox", "label": "Agent is active", "value": "agent.isActive" },
            { "id": "cancel-btn", "type": "button", "text": "Cancel", "action": "closes dialog" },
            { "id": "save-btn", "type": "button", "text": "Save Changes", "action": "updateAgent" }
          ]
        }
      ]
    },
    {
      "id": "SCR011",
      "name": "Conversation View",
      "description": "Active conversation with messages, participants, context panel, and stats",
      "path": "/app/ai-agents/conversations/{id}",
      "file": "orbitos-web/app/pages/app/ai-agents/conversations/[id].vue",
      "status": "implemented",
      "ui_elements": [
        {
          "id": "SCR011-EL01",
          "name": "Header",
          "type": "section",
          "elements": [
            { "id": "title", "type": "text", "field": "conversation.title" },
            { "id": "participants-chips", "type": "chip-list", "items": "participants" },
            { "id": "add-btn", "type": "button", "text": "Add", "action": "add participant" },
            { "id": "settings-btn", "type": "button", "text": "Settings" },
            { "id": "mode-dropdown", "type": "dropdown", "options": ["On-Demand", "Moderated", "Round-Robin", "Free (Caution)"] },
            { "id": "turns-display", "type": "text", "format": "Turns: {current}/{max}" },
            { "id": "tokens-display", "type": "text", "format": "Tokens: {used}/{limit}" },
            { "id": "cost-display", "type": "text", "format": "Cost: ${cost}" },
            { "id": "resume-btn", "type": "button", "text": "Resume" },
            { "id": "pause-btn", "type": "button", "text": "Pause" }
          ]
        },
        {
          "id": "SCR011-EL02",
          "name": "Left Sidebar - Agents & Team",
          "type": "sidebar",
          "elements": [
            { "id": "search", "type": "search-input", "placeholder": "Search agents..." },
            { "id": "ai-agents-section", "type": "list", "title": "AI Agents", "items": "configured agents" },
            { "id": "team-members-section", "type": "list", "title": "Team Members", "items": "organization users", "shows": "online status" },
            { "id": "conversations-section", "type": "list", "title": "Conversations", "items": "recent conversations" }
          ]
        },
        {
          "id": "SCR011-EL03",
          "name": "Message Area",
          "type": "section",
          "elements": [
            { "id": "messages-list", "type": "scrollable-list", "items": "messages" },
            { "id": "message-item", "type": "message-bubble", "elements": [
              { "id": "avatar", "type": "avatar" },
              { "id": "sender-name", "type": "text" },
              { "id": "model-badge", "type": "badge", "condition": "sender is AI" },
              { "id": "timestamp", "type": "text" },
              { "id": "content", "type": "markdown" },
              { "id": "metric-cards", "type": "card-list", "condition": "has metrics" },
              { "id": "sources", "type": "link-list", "condition": "has sources" },
              { "id": "token-info", "type": "text", "condition": "sender is AI", "format": "{tokens} tokens • {time}s • ${cost}" }
            ]},
            { "id": "quick-actions", "type": "button-group", "items": ["Ask all AIs", "Summarize", "Export chat", "Pause all AIs"] },
            { "id": "message-input", "type": "textarea", "placeholder": "Type a message... Use @AgentName to invoke specific AI" },
            { "id": "send-btn", "type": "button", "icon": "send" }
          ]
        },
        {
          "id": "SCR011-EL04",
          "name": "Right Sidebar - Context & Stats",
          "type": "sidebar",
          "elements": [
            { "id": "org-context-section", "type": "section", "title": "Organizational Context" },
            { "id": "referenced-section", "type": "section", "title": "Referenced in Chat", "items": "referenced items" },
            { "id": "context-access-section", "type": "section", "title": "Full Context Access", "items": ["Canvases", "Processes", "Roles", "Resources", "Goals & OKRs", "Metrics"] },
            { "id": "stats-section", "type": "section", "title": "Session Stats", "items": [
              { "label": "Messages", "value": "messageCount" },
              { "label": "AI Responses", "value": "aiResponseCount" },
              { "label": "Total Tokens", "value": "totalTokens" },
              { "label": "Est. Cost", "value": "totalCost" },
              { "label": "Duration", "value": "duration" }
            ]}
          ]
        }
      ]
    }
  ],

  "best_practices": {
    "description": "Recommended practices for effective AI agent configuration and usage",
    "practices": [
      {
        "title": "Create Complementary Agents",
        "description": "Design agents with different perspectives that balance each other. A risk-averse CFO paired with an opportunity-focused Strategy consultant creates productive tension that leads to better decisions."
      },
      {
        "title": "Be Specific in System Prompts",
        "description": "Vague prompts lead to generic responses. Include specific frameworks, methodologies, and examples of how the agent should think. Reference the organization's actual context."
      },
      {
        "title": "Match Model to Task",
        "description": "Use Opus for complex analysis and important decisions. Use Sonnet for daily advisory. Use Haiku for quick checks and simple questions. This optimizes both cost and quality."
      },
      {
        "title": "Set Appropriate Temperature",
        "description": "Lower temperature (0.2-0.4) for factual analysis and consistent advice. Higher temperature (0.6-0.8) for brainstorming and creative solutions."
      },
      {
        "title": "Start with On-Demand Mode",
        "description": "Begin with On-Demand mode to learn how agents respond, then experiment with Round-Robin or Free-Form for collaborative discussions."
      },
      {
        "title": "Review Pending Actions",
        "description": "Always review AI-proposed changes carefully. The pending action workflow exists to keep humans in control of actual data modifications."
      }
    ]
  },

  "security_requirements": [
    "All conversation data must be scoped by organization_id",
    "AI agents can only access data within their configured context permissions",
    "Message content must be sanitized to prevent injection attacks",
    "API keys for external AI providers must be stored encrypted",
    "Conversation export must respect data access permissions",
    "Rate limiting on AI invocation endpoints to prevent abuse",
    "Audit logging for all AI-proposed data modifications"
  ],

  "performance_requirements": [
    "Message send response time < 200ms (before AI processing)",
    "AI response streaming should begin within 2 seconds",
    "Conversation list load time < 500ms",
    "Message history pagination must support 1000+ messages efficiently"
  ],

  "dependencies": {
    "features": ["F001"],
    "external_services": [
      "Anthropic Claude API"
    ],
    "future_external_services": [
      "OpenAI API",
      "Google Gemini API"
    ]
  },

  "test_coverage": {
    "unit_tests": [
      "AI agent configuration validation",
      "Message parsing and @mention extraction",
      "Conversation mode logic",
      "Token counting and cost calculation"
    ],
    "integration_tests": [
      "Create agent flow",
      "Update agent flow",
      "Delete agent flow",
      "Create conversation flow",
      "Send message and receive AI response",
      "Multi-agent response ordering",
      "Conversation export"
    ],
    "e2e_tests": {
      "files": [
        "orbitos-web/tests/e2e/ai-agents.spec.ts",
        "orbitos-web/tests/e2e/conversations.spec.ts"
      ],
      "test_suites": [
        {
          "name": "AI Agents Page - Navigation & Layout",
          "tests": [
            "should display AI Agents page with correct heading",
            "should display Add Agent button",
            "should display stats cards",
            "should display empty state when no agents exist",
            "should have AI Agents link in sidebar navigation"
          ]
        },
        {
          "name": "AI Agents - Create Agent Dialog",
          "tests": [
            "should open create agent dialog when clicking Add Agent",
            "should display all form fields in create dialog",
            "should have correct default values in create dialog",
            "should show only Anthropic models in dropdown",
            "should populate system prompt when selecting template",
            "should close dialog when clicking Cancel",
            "should close dialog when pressing Escape",
            "should close dialog when clicking backdrop",
            "should disable Create button when required fields are empty",
            "should enable Create button when required fields are filled"
          ]
        },
        {
          "name": "AI Agents - CRUD Operations",
          "tests": [
            "should create a new agent successfully",
            "should display agent card with correct information",
            "should open edit dialog when clicking Edit",
            "should update agent when editing",
            "should toggle agent active/inactive",
            "should delete agent when clicking Delete"
          ]
        },
        {
          "name": "AI Agents - Model Configuration",
          "tests": [
            "should create agent with Claude Sonnet model",
            "should create agent with Claude Opus model",
            "should create agent with Claude Haiku model",
            "should configure custom max tokens",
            "should configure custom temperature"
          ]
        },
        {
          "name": "AI Agents - Avatar Colors",
          "tests": [
            "should display avatar color options",
            "should select different avatar color"
          ]
        },
        {
          "name": "AI Agents - System Prompt Templates",
          "tests": [
            "should load CFO template",
            "should load Operations template",
            "should load Strategy template",
            "should load HR template",
            "should allow custom system prompt editing"
          ]
        },
        {
          "name": "AI Agents - Stats Cards",
          "tests": [
            "should update Total Agents count after creating agent",
            "should update Active count when toggling agent"
          ]
        },
        {
          "name": "Conversations - CRUD Operations",
          "tests": [
            "should create a new conversation",
            "should display conversation in list",
            "should open conversation page",
            "should send a message",
            "should invoke AI agent with @mention",
            "should change conversation mode",
            "should pause and resume conversation",
            "should delete conversation"
          ]
        },
        {
          "name": "Conversations - Session Stats",
          "tests": [
            "should display message count",
            "should display AI response count",
            "should display total tokens",
            "should display estimated cost",
            "should display duration"
          ]
        }
      ]
    }
  },

  "ux_review_notes": {
    "completed_review": true,
    "review_date": "2026-01-22",
    "completed_items": [
      "Responsive design on mobile verified",
      "Keyboard navigation working",
      "Loading states and error handling reviewed",
      "Dialog interactions tested (no @click.self issues)"
    ],
    "known_issues": []
  }
}
